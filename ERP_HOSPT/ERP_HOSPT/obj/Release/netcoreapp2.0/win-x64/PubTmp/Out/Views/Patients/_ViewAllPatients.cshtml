@model IEnumerable<ERP_HOSPT.Data.Patient>

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager


    <div class="row">
        @if (ViewBag.key == false)
        {
            <div class="col-lg-6 " style="margin:150px 250px 0px 0px ">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <h4 class="alert-heading">رساله من النظام</h4>
                    <p>
                        لقد تم ايقاف خدمه السجلات الصحيه عن هاذا النظام
                    </p>
                    <hr>
                    <p class="mb-0">راجع مقدمي السجلات الصحيه</p>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

            </div>
        }
        else
        {


    <div class="col-lg-12 ">

        <div class="card">


            <div class="row">

                <div class="card-body">
                    <br />
                    <h4 scope="col" style="text-align:right;">السجل الصحي</h4>

                    <!-- Horizontal Form -->
                    <form asp-action="index">
                        <div class="row mb-3">
                            <div class="col-sm-10">
                                <input name="Patientname" type="text" class="form-control" id="inputText">
                            </div>
                        </div>

                        <div class="row mb-5">
                            <div class="col-sm-2" scope="col" style="text-align: right;">

                                <h5 scope="col" style="text-align:right;">البحث بحسب </h5>

                                <div class="form-check form-switch">
                                    <label class="form-check-label" for="flexSwitchCheckDefault" scope="col" style="text-align:right;">اسم المريض</label>
                                    <input class="form-check-input" name="id" type="radio" id="flexSwitchCheckDefault" dir="rtl" value=1>

                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="radio" id="flexSwitchCheckChecked" name="PatientId" value="2">
                                    <label class="form-check-label" for="flexSwitchCheckChecked">الرقم المريض</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="radio" id="flexSwitchCheckDisabled" name="PatientId" value="3">
                                    <label class="form-check-label" for="flexSwitchCheckDisabled">الموبايل</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="radio" id="flexSwitchCheckCheckedDisabled" name="PatientId" value="4">
                                    <label class="form-check-label" for="flexSwitchCheckCheckedDisabled">رقم الوطني</label>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary col-2"> <i class="bi bi-search"></i>  بحث</button>
                            <button type="reset" class="btn btn-secondary col-2"><i class="bi bi-arrow-repeat me-1"></i> تحديث</button>
                        </div>
                    </form><!-- End Horizontal Form -->

                </div>
            </div>



        </div>

        </div>
        @if (SignInManager.IsSignedIn(User) && (User.IsInRole("المسجل عام")))
        {
            <!-- End Page Title -->
            <div>
                <section class="section">
                    <div class="row">
                        <div class="col-lg-12">

                            <div class="card">
                                <div class="card-body">

                                    <table class="table table-hover datatable ">

                                        <thead>
                                            <tr class="table-header">
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.Patientname)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_nat)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_addr)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_job)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_data)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_sex)
                                                </th>
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_mobile)
                                                </th>
                                                @*<th scope="col">
                                                    @Html.DisplayNameFor(model => model.pa_phone)
                                                </th>*@
                                                @*<th scope="col">
                                                    @Html.DisplayNameFor(model => model.pa_email)
                                                </th>*@
                                                <th scope="col" style="text-align:right;">
                                                    @Html.DisplayNameFor(model => model.pa_note)
                                                </th>
                                                @*<th scope="col">
                                                    @Html.DisplayNameFor(model => model.Region)
                                                </th>
                                                <th scope="col">
                                                    @Html.DisplayNameFor(model => model.city)
                                                </th>*@
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model)
                                            {
                                                <tr id="row_@item.PatientId">
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.Patientname)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_nat)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_addr)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_job)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_data)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_sex)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_mobile)
                                                    </td>
                                                    @*<td>
                                                        @Html.DisplayFor(modelItem => item.pa_phone)
                                                    </td>*@
                                                    @*<td>
                                                        @Html.DisplayFor(modelItem => item.pa_email)
                                                    </td>*@
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.pa_note)
                                                    </td>
                                                    @*<td>
                                                        @Html.DisplayFor(modelItem => item.Region.reg_name)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.city.cit_name)
                                                    </td>*@

                                                    <td>
                                                        <div>

                                                            <a onclick="showInPopup('@Url.Action("CreateInterview", "Patients", new { id = item.PatientId }, Context.Request.Scheme)','اضافة مقابلة')" class=" btn btn-outline-warning">مقابلة >></a>

                                                        </div>


                                                    </td>

                                                    <td>
                                                        <div>
                                                            <a onclick="showInPopup('@Url.Action("Edit", "Patients", new { id = item.PatientId }, Context.Request.Scheme)','تعديل')" title="هل تريد التعديل"><i class="fas fa-pen-alt" style="color:yellow"></i></a>

                                                            <a onclick="ConfirmDelete(@item.PatientId)" title="هل تريد الحذف"><i class="fas fa-trash-alt" style="color:red"></i></a>



                                                        </div>
                                                    </td>

                                                </tr>

                                            }


                                        </tbody>

                                    </table>

                                    <!-- End Table with stripped rows -->
                                    <p>
                                        @if (User.IsInRole("المسجل عام"))
                                        {
                                            <a onclick="showInPopup('@Url.Action("Create", "Patients", null, Context.Request.Scheme)','اضافه مريض جدبد')" class="btn btn-success text-white" title="اضافه تحليل"><i class="fas fa-plus"></i> اضافه مريض جديد</a>
                                        }
                                    </p>

                                </div>
                            </div>

                        </div>
                    </div>
                </section>

                <div class="modal fade" id="myModal" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" dir="rtl">
                            <div class="modal-header" style=" background-color: #4154f1;
        color: white;">

                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                <h5 class="modal-title" dir="rtl">حذف</h5>
                            </div>
                            <div class="modal-body">
                                <h4>هل  تريد حذف هاذا</h4>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">اغلاق</button>
                                <button type="button" class="btn btn-danger" onclick="DeleteConfirmed()">حذف</button>
                            </div>
                        </div>
                    </div>
                </div><!-- End Vertically centered Modal-->


                <input type="hidden" id="hiddenEmployeeId" />

            </div>}

        @if (SignInManager.IsSignedIn(User) && User.IsInRole("دكتور"))



        {<div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th scope="col" style="text-align:right;">
                                            @Html.DisplayNameFor(model => model.Patientname)
                                        </th>

                                        <th scope="col" style="text-align:right;">
                                            @Html.DisplayNameFor(model => model.pa_addr)
                                        </th>

                                        <th scope="col" style="text-align:right;">
                                            @Html.DisplayNameFor(model => model.pa_data)
                                        </th>
                                        <th scope="col" style="text-align:right;">
                                            @Html.DisplayNameFor(model => model.pa_sex)
                                        </th>
                                        <th scope="col" style="text-align:right;">
                                            @Html.DisplayNameFor(model => model.pa_mobile)
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr id="row_@item.PatientId">
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Patientname)
                                            </td>

                                            <td>
                                                @Html.DisplayFor(modelItem => item.pa_addr)
                                            </td>

                                            <td>
                                                @Html.DisplayFor(modelItem => item.pa_data)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.pa_sex)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.pa_mobile)
                                            </td>




                                            <td>
                                                <div>
                                                    <a type="button" asp-controller="Patients" asp-action="show" asp-route-id="@item.PatientId" class=" btn btn-outline-primary col-7  me-1  text-dark " style=" font-weight: bold;">
                                                        <i class="bi bi-record2-fill" style="color:#4154f1;" aria-hidden="true"></i> السجلات الصحية
                                                    </a>

                                                </div>


                                            </td>


                                        </tr>

                                    }


                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>



        }
        }
        @if (ViewBag.Interview != null)
        {
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">

                <h5 class="card-title">السجل الصحي</h5>

                <!-- Table with stripped rows -->
                <table class="table table-hover">
                    <thead class="table-header">
                        <tr>
                            <th scope="col">رقم الزياره</th>
                            <th scope="col">اسم المريض</th>
                            <th scope="col">ملاحظه</th>
                            <th scope="col">نوع المقابله</th>
                            <th scope="col">التاريخ</th>
                            <th scope="col"></th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in ViewBag.Interview)
                        {
                            <tr>
                                <th scope="row">@item.interviewId</th>
                                <td>
                                    @Html.DisplayNameFor(model => model.Patientname)
                                </td>
                                <td>@item.inter_notes</td>
                                <td>@item.inter_type</td>
                                <td>@item.inter_date</td>
                                <td>
                                    <a class=" ri-article-line ri-archive-fill col-8 nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">السجل الصحي</a>

                                    <ul class="dropdown-menu col-3" aria-labelledby="navbarDropdown">
                                        <li>
                                            <a onclick="showInPopup1('@Url.Action("InvoiceDrug2", "interviews", new { id = item.interviewId }, Context.Request.Scheme)',' الادويه')" class="btn btn-outline-primary col-5">  <i class="fas fa-capsules" style="color:#4154f1;" aria-hidden="true"></i>  العلاجات</a>
                                        </li>
                                        <li>
                                            <a onclick="showInPopup1('@Url.Action("InvoiceDiagnosis2", "interviews", new { id = item.interviewId }, Context.Request.Scheme)',' التشخيص')" class="btn btn-outline-primary col-5">  <i class="fas fa-prescription-bottle-alt" style="color:#4154f1;" aria-hidden="true"></i>   التشخيص</a>
                                        </li>

                                        <li>
                                            <a type="button" asp-controller="R_analysis" asp-action="show1" asp-route-id="@item.interviewId" class="btn btn-outline-primary col-5">  <i class="fas fa-microscope" style="color:#4154f1;" aria-hidden="true"></i>  الفحوصات  </a>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        }

                    </tbody>
                </table>
                <!-- End Table with stripped rows -->

            </div>
        </div>
        </div>
        }
    </div>

        <script>

            var ConfirmDelete = function (id) {

                $("#hiddenEmployeeId").val(id);
                $("#myModal").modal('show');




            }

            var DeleteConfirmed = function () {

                $("#loaderDiv").show();

                var empId = $("#hiddenEmployeeId").val();

                $.ajax({

                    type: "POST",
                    url: "/Patients/DeleteConfirmed",
                    data: { id: empId },

                    success: function (rsul) {
                        $("#loaderDiv").hide();
                        $("#myModal").modal("hide");
                        $("#row_" + empId).remove();
                        Swal.fire('تم الحذف!',
                            'You clicked the button!',
                            'success')

                    },
                    error: function (response) {
                        Swal.fire('لم يتم الحذف',
                            'Your imaginary file is safe :)',
                            'error')
                    }

                })

            }


        </script>
